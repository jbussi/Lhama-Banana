{% extends "base.html" %}

{% block page_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/perfil.css') }}">
{% endblock %}

{% block title %}Meu Perfil - LhamaBanana{% endblock %}

{% block content %}
    
<div class="profile-page">
    <div class="profile-container">
        <!-- Container para mensagens inline -->
        <div id="profile-messages-container" class="profile-messages-container"></div>
        
        <!-- Cabeçalho do Perfil -->
        <div class="profile-header">
            <div class="profile-avatar">
                <img src="{{ url_for('static', filename='img/avatar-placeholder.png') }}" alt="Foto de perfil" id="profile-pic">
                <button class="change-avatar-btn" id="change-avatar-btn">
                    <i class="fas fa-camera"></i>
                </button>
                <input type="file" id="profile-pic-input" accept="image/*" style="display: none;">
            </div>
            <h1>Olá, <span id="profile-name"></span>!</h1>
            <p class="member-since">Membro desde <span id="profile-join-date"></span></p>
            <button class="btn btn-outline" id="logout-btn" style="margin-top: 1rem;">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>

        <div class="profile-sections">
            <!-- Seção de Informações Pessoais -->
            <section class="profile-section">
                <div class="section-header">
                    <h2><i class="fas fa-user"></i> Informações Pessoais</h2>
                    <button class="btn btn-outline" id="edit-btn">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                </div>
                
                <div class="info-grid" id="personal-info-view">
                    <div class="info-item">
                        <span class="info-label">Nome Completo</span>
                        <p class="info-value" id="view-name"></p>
                    </div>
                    <div class="info-item">
                        <span class="info-label">E-mail</span>
                        <p class="info-value" id="view-email"></p>
                    </div>
                    <div class="info-item">
                        <span class="info-label">CPF</span>
                        <p class="info-value" id="view-cpf"></p>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Data de Nascimento</span>
                        <p class="info-value" id="view-birthdate"></p>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Telefone</span>
                        <p class="info-value" id="view-phone"></p>
                    </div>
                </div>

                <!-- Formulário de Edição (inicialmente oculto) -->
                <form id="personal-info-edit" class="info-grid" style="display: none;">
                    <div class="form-group">
                        <label for="edit-name">Nome Completo</label>
                        <input type="text" id="edit-name" class="edit-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-email">E-mail</label>
                        <input type="email" id="edit-email" class="edit-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-cpf">CPF</label>
                        <input type="text" id="edit-cpf" class="edit-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-birthdate">Data de Nascimento</label>
                        <input type="date" id="edit-birthdate" class="edit-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-phone">Telefone</label>
                        <input type="tel" id="edit-phone" class="edit-input">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancel-btn">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="save-btn">Salvar Alterações</button>
                    </div>
                </form>
            </section>

            <!-- Seção de Endereços -->
            <section class="profile-section">
                <div class="section-header">
                    <h2><i class="fas fa-map-marker-alt"></i> Meus Endereços</h2>
                    <button class="btn btn-outline" id="add-address-btn">
                        <i class="fas fa-plus"></i> Novo Endereço
                    </button>
                </div>

                <!-- Lista de Endereços -->
                <div class="addresses-grid" id="addresses-list">
                    <!-- Endereço de exemplo 1 -->
                    <div class="address-card">
                        <h4><i class="fas fa-home"></i> Casa</h4>
                        <p>Rua das Flores, 123</p>
                        <p>Apto 101, Bloco B</p>
                        <p>Jardim Primavera, São Paulo - SP</p>
                        <p>CEP: 01234-567</p>
                        <p>Telefone: (11) 98765-4321</p>
                        <div class="address-actions">
                            <button class="btn btn-outline btn-sm edit-address" data-id="1">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-outline btn-sm remove-address" data-id="1">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </div>
                    </div>

                    <!-- Endereço de exemplo 2 -->
                    <div class="address-card">
                        <h4><i class="fas fa-briefcase"></i> Trabalho</h4>
                        <p>Avenida Paulista, 1000</p>
                        <p>Sala 1500, 15º andar</p>
                        <p>Bela Vista, São Paulo - SP</p>
                        <p>CEP: 01310-100</p>
                        <p>Telefone: (11) 98765-1234</p>
                        <div class="address-actions">
                            <button class="btn btn-outline btn-sm edit-address" data-id="2">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-outline btn-sm remove-address" data-id="2">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Formulário de Novo Endereço (inicialmente oculto) -->
                <form id="new-address-form" style="display: none;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="address-type">Tipo de Endereço</label>
                            <select id="address-type" class="edit-input">
                                <option value="home">Casa</option>
                                <option value="work">Trabalho</option>
                                <option value="other">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="address-cep">CEP</label>
                            <div class="cep-input-group">
                                <input type="text" id="address-cep" class="edit-input" placeholder="00000-000" maxlength="9">
                                <button type="button" id="buscar-cep-btn" class="btn-cep-buscar">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address-street">Rua</label>
                            <input type="text" id="address-street" class="edit-input" placeholder="Nome da rua">
                        </div>
                        <div class="form-group">
                            <label for="address-number">Número</label>
                            <input type="text" id="address-number" class="edit-input" placeholder="Número">
                        </div>
                        <div class="form-group">
                            <label for="address-complement">Complemento</label>
                            <input type="text" id="address-complement" class="edit-input" placeholder="Apto, bloco, etc.">
                        </div>
                        <div class="form-group">
                            <label for="address-neighborhood">Bairro</label>
                            <input type="text" id="address-neighborhood" class="edit-input" placeholder="Bairro">
                        </div>
                        <div class="form-group">
                            <label for="address-city">Cidade</label>
                            <input type="text" id="address-city" class="edit-input" placeholder="Cidade">
                        </div>
                        <div class="form-group">
                            <label for="address-state">Estado</label>
                            <select id="address-state" class="edit-input">
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="address-phone">Telefone</label>
                            <input type="tel" id="address-phone" class="edit-input" placeholder="(00) 00000-0000">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" id="cancel-new-address">Cancelar</button>
                            <button type="button" class="btn btn-primary" id="save-new-address">Salvar Endereço</button>
                        </div>
                    </div>
                </form>
            </section>

            <!-- Seção de Segurança e Verificação -->
            <section class="profile-section">
                <div class="section-header">
                    <h2><i class="fas fa-shield-alt"></i> Segurança da Conta</h2>
                </div>
                
                <!-- Status de Verificação de Email -->
                <div class="security-item" id="email-verification-status">
                    <div class="security-info">
                        <h3><i class="fas fa-envelope"></i> Verificação de Email</h3>
                        <p id="email-verification-text">Verificando status...</p>
                    </div>
                    <div class="security-actions">
                        <button class="btn btn-outline" id="resend-verification-btn" style="display: none;">
                            <i class="fas fa-paper-plane"></i> Reenviar Verificação
                        </button>
                        <button class="btn btn-outline" id="refresh-verification-btn">
                            <i class="fas fa-sync-alt"></i> Atualizar Status
                        </button>
                    </div>
                </div>

                <!-- Alteração de Senha -->
                <div class="security-item">
                    <div class="security-info">
                        <h3><i class="fas fa-key"></i> Alterar Senha</h3>
                        <p>Altere sua senha para manter sua conta segura</p>
                    </div>
                    <div class="security-actions">
                        <button class="btn btn-outline" id="change-password-btn">
                            <i class="fas fa-edit"></i> Alterar Senha
                        </button>
                    </div>
                </div>

                <!-- Formulário de Alteração de Senha (inicialmente oculto) -->
                <form id="change-password-form" style="display: none;" class="security-form">
                    <div class="form-group">
                        <label for="current-password">Senha Atual</label>
                        <input type="password" id="current-password" class="edit-input" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">Nova Senha</label>
                        <input type="password" id="new-password" class="edit-input" required minlength="6">
                        <small class="form-text">Mínimo de 6 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirmar Nova Senha</label>
                        <input type="password" id="confirm-password" class="edit-input" required minlength="6">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancel-password-btn">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="save-password-btn">Salvar Nova Senha</button>
                    </div>
                </form>

                <!-- Verificação em Duas Etapas (2FA) - Apenas para Administradores -->
                <div class="security-item" id="mfa-section" style="display: none;">
                    <div class="security-info">
                        <h3><i class="fas fa-shield-alt"></i> Verificação em Duas Etapas (2FA)</h3>
                        <p id="mfa-status-text">Verificando status...</p>
                    </div>
                    <div class="security-actions">
                        <button class="btn btn-outline" id="enable-mfa-btn" style="display: none;">
                            <i class="fas fa-key"></i> Habilitar 2FA
                        </button>
                        <button class="btn btn-outline" id="disable-mfa-btn" style="display: none;">
                            <i class="fas fa-times"></i> Desabilitar 2FA
                        </button>
                    </div>
                </div>

                <!-- Formulário de Configuração 2FA (inicialmente oculto) -->
                <div id="mfa-setup-form" style="display: none;" class="security-form">
                    <div class="form-group">
                        <label>Passo 1: Escaneie o QR Code</label>
                        <div style="text-align: center; margin: 1rem 0;">
                            <img id="mfa-qr-code" src="" alt="QR Code 2FA" style="max-width: 250px; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: white;">
                        </div>
                        <p style="font-size: 0.9rem; color: #666; text-align: center;">
                            Use um app autenticador como Google Authenticator, Authy ou Microsoft Authenticator
                        </p>
                    </div>
                    <div class="form-group">
                        <label>Passo 2: Digite a chave manualmente (opcional)</label>
                        <input type="text" id="mfa-manual-key" class="edit-input" readonly style="font-family: monospace;">
                        <small class="form-text">Use esta chave se não conseguir escanear o QR code</small>
                    </div>
                    <div class="form-group">
                        <label for="mfa-verify-code">Passo 3: Digite o código de 6 dígitos</label>
                        <input type="text" id="mfa-verify-code" class="edit-input" placeholder="000000" maxlength="6" pattern="[0-9]{6}">
                        <small class="form-text">Digite o código de 6 dígitos do seu app autenticador</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancel-mfa-setup-btn">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="confirm-mfa-btn">Confirmar e Habilitar</button>
                    </div>
                </div>

                <!-- Formulário para Desabilitar 2FA (inicialmente oculto) -->
                <div id="mfa-disable-form" style="display: none;" class="security-form">
                    <div class="form-group">
                        <label for="mfa-disable-code">Digite o código 2FA para confirmar</label>
                        <input type="text" id="mfa-disable-code" class="edit-input" placeholder="000000" maxlength="6" pattern="[0-9]{6}">
                        <small class="form-text">É necessário confirmar com um código 2FA para desabilitar</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancel-mfa-disable-btn">Cancelar</button>
                        <button type="button" class="btn btn-danger" id="confirm-disable-mfa-btn">Desabilitar 2FA</button>
                    </div>
                </div>
            </section>

            <!-- Seção de Histórico de Pedidos -->
            <section class="profile-section" id="orders-section">
                <div class="section-header">
                    <h2><i class="fas fa-shopping-bag"></i> Meus Pedidos</h2>
                </div>
                
                <div class="empty-state" id="orders-container">
                    <i class="fas fa-shopping-basket"></i>
                    <h3>Nenhum pedido encontrado</h3>
                    <p>Você ainda não realizou nenhum pedido em nossa loja. Aproveite para conhecer nossos produtos!</p>
                    <a href="{{ url_for('produtos.produtos_page') }}" class="btn-shop-now">
                        <i class="fas fa-shopping-bag"></i> Ir para a Loja
                    </a>
                </div>
            </section>
        </div>
    </div>
</div>

<script type="module" src="{{ url_for('main.static', filename='js/profile.js') }}"></script>
{% endblock %}
