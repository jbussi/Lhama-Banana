{% extends "base.html" %}

{% block page_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/checkout.css') }}">
{% endblock %}

{% block title %}Finalizar Compra - LhamaBanana{% endblock %}

{% block content %}


<div class="checkout-container">
    <!-- Progress Steps -->
    <div class="checkout-steps">
        <div class="step active">
            <div class="step-number">1</div>
            <span class="step-text">Endereço</span>
        </div>
        <div class="step">
            <div class="step-number">2</div>
            <span class="step-text">Pagamento</span>
        </div>
        <div class="step">
            <div class="step-number">3</div>
            <span class="step-text">Confirmação</span>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="checkout-layout">
        <!-- Left Column - Address & Payment -->
        <div class="checkout-main">
            <!-- Address Section -->
            <div class="checkout-section">
                <h2 class="section-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Endereço de Entrega
                </h2>
                
                <!-- Container para endereços salvos -->
                <div id="saved-addresses-section">
                    <div class="address-list">
                        <!-- Endereços serão injetados aqui pelo JS -->
                    </div>
                    
                    <div id="no-saved-addresses-message" class="text-center py-4" style="display: none;">
                        <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
                        <p>Nenhum endereço cadastrado</p>
                        <p class="text-muted small">Preencha o formulário abaixo ou <a href="#" id="login-link">faça login</a> para usar seus endereços salvos.</p>
                    </div>
                    
                    <button id="add-new-address-btn" class="add-address-btn">
                        <i class="fas fa-plus"></i> Adicionar novo endereço
                    </button>
                </div>
                
                <!-- Formulário de Endereço Manual (Inicialmente escondido) -->
                <div id="manual-address-form-section" style="display: none;">
                    <h3 class="section-title">Preencha o Novo Endereço</h3>
                    <form id="manual-address-form">
                    <div class="form-group">
                        <label for="manual-recipient-name">Nome Completo do Recebedor:</label>
                        <input type="text" id="manual-recipient-name" class="form-control" value="{{ user_name if user_logged_in else '' }}" required>
                    </div>
                        <div class="form-group">
                            <label for="manual-street">Rua:</label>
                            <input type="text" id="manual-street" class="form-control" required>
                        </div>
                        <div class="form-group row">
                            <div class="col-6">
                                <label for="manual-number">Número:</label>
                                <input type="text" id="manual-number" class="form-control" required>
                            </div>
                            <div class="col-6">
                                <label for="manual-complement">Complemento:</label>
                                <input type="text" id="manual-complement" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="manual-district">Bairro:</label>
                            <input type="text" id="manual-district" class="form-control" required>
                        </div>
                        <div class="form-group row">
                            <div class="col-6">
                                <label for="manual-city">Cidade:</label>
                                <input type="text" id="manual-city" class="form-control" required>
                            </div>
                            <div class="col-6">
                                <label for="manual-state">Estado (UF):</label>
                                <input type="text" id="manual-state" class="form-control" maxlength="2" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="manual-postal-code">CEP:</label>
                            <input type="text" id="manual-postal-code" class="form-control" required>
                        </div>
                    <div class="form-group" id="email-field-group" style="display: none;">
                        <label for="manual-email">E-mail:</label>
                        <input type="email" id="manual-email" class="form-control" value="{{ user_email if user_logged_in else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="manual-phone">Telefone (apenas números, com DDD):</label>
                        <input type="text" id="manual-phone" class="form-control" required>
                    </div>
                        <button type="button" id="use-saved-addresses-btn" class="btn btn-secondary mt-3" style="display:none;">
                            <i class="fas fa-arrow-left"></i> Voltar para endereços salvos
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Payment Method Section -->
            <div class="checkout-section">
                <h2 class="section-title">
                    <i class="fas fa-credit-card"></i>
                    Método de Pagamento
                </h2>
                
                <div class="payment-methods">
                    <label class="payment-option">
                        <input type="radio" name="payment-method" value="credit-card" checked>
                        <i class="fas fa-credit-card payment-icon"></i>
                        <div class="payment-details">
                            <div class="payment-title">Cartão de Crédito</div>
                            <div class="payment-description">Pague com seu cartão de crédito</div>
                        </div>
                    </label>
                    
                    <label class="payment-option">
                        <input type="radio" name="payment-method" value="pix">
                        <i class="fas fa-qrcode payment-icon"></i>
                        <div class="payment-details">
                            <div class="payment-title">PIX</div>
                            <div class="payment-description">Pague via PIX com QR Code</div>
                        </div>
                    </label>
                    
                    <label class="payment-option">
                        <input type="radio" name="payment-method" value="boleto">
                        <i class="fas fa-barcode payment-icon"></i>
                        <div class="payment-details">
                            <div class="payment-title">Boleto Bancário</div>
                            <div class="payment-description">Pague com boleto bancário</div>
                        </div>
                    </label>
                </div>

                <!-- Formulário de Cartão de Crédito (Inicialmente escondido) -->
                <div class="checkout-section" id="credit-card-form-section">
                    <h3 class="section-title">Dados do Cartão de Crédito</h3>
                    <form id="credit-card-form">
                        <div class="form-group">
                            <label for="card-number">Número do Cartão:</label>
                            <input type="text" id="card-number" class="form-control" placeholder="**** **** **** ****" required>
                        </div>
                        <div class="form-group">
                            <label for="card-holder-name">Nome Impresso no Cartão:</label>
                            <input type="text" id="card-holder-name" class="form-control" required>
                        </div>
                        <div class="form-group row">
                            <div class="col-6">
                                <label for="card-expiry">Validade:</label>
                                <input type="text" id="card-expiry" class="form-control" placeholder="MM/AA" required>
                            </div>
                            <div class="col-6">
                                <label for="card-cvv">CVV:</label>
                                <input type="text" id="card-cvv" class="form-control" placeholder="***" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="card-installments">Parcelas:</label>
                            <select id="card-installments" class="form-control" required>
                                <!-- Opções serão carregadas dinamicamente -->
                                <option value="1">1x</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="card-holder-tax-id">CPF/CNPJ do Titular:</label>
                            <input type="text" id="card-holder-tax-id" class="form-control" placeholder="000.000.000-00" required>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Right Column - Order Summary -->
        <div class="order-summary">
            <h2 class="section-title">
                <i class="fas fa-shopping-bag"></i>
                Resumo do Pedido
            </h2>
            
            <div class="order-items">
                <!-- Itens do carrinho serão injetados aqui pelo JS -->
            </div>
            
            <div class="coupon-section">
                <h3 class="mb-2">Possui um cupom de desconto?</h3>
                <form id="coupon-form" class="coupon-form">
                    <input type="text" class="coupon-input" placeholder="Código do cupom" >
                    <button type="submit" class="btn-apply">Aplicar</button>
                </form>
            </div>
            
            <div class="order-totals">
                <!-- Totais serão injetados aqui pelo JS -->
            </div>
            
            <button class="btn-checkout" id="checkout-btn">
                <i class="fas fa-lock"></i>
                Finalizar Compra
            </button>
            
            <p class="text-center mt-3 text-muted small">
                <i class="fas fa-lock"></i> Pagamento 100% seguro
            </p>
        </div>
    </div>
</div>

<!-- PagBank SDK (opcional, para tokenização de cartão no frontend) -->
<!-- Descomente e configure com seu APP_ID quando necessário -->
<!-- <script src="https://assets.pagseguro.com.br/checkout-sdk/checkout-sdk.js" data-app-id="SEU_APP_ID"></script> -->

<!-- Script principal do checkout - toda a lógica está aqui -->
<script type="module" src="{{ url_for('main.static', filename='js/checkout.js') }}"></script>
{% endblock %}