{% extends "base.html" %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/hero.css') }}">
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/home.css') }}">
<link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
{% endblock %}

{% block content %}

<section class="hero">
  <div class="hero-text">
    {% if hero and hero.titulo %}
    <h1>{{ hero.titulo }}</h1>
    {% else %}
    <h1>Noites tranquilas, sorrisos garantidos!</h1>
    {% endif %}
    {% if hero and hero.subtitulo %}
    <p>{{ hero.subtitulo }}</p>
    {% else %}
    <p>Somos uma marca feita por fam√≠lias, para fam√≠lias. Aqui voc√™ encontra qualidade, conforto e muito carinho em cada detalhe.</p>
    {% endif %}
    <button class="btn-collection" type="button" onclick="window.location.href='{{ url_for('produtos.produtos_page') }}'" aria-label="Navegar pela loja">
      <span>ü¶ô</span>
      <span>{{ hero.texto_botao if hero and hero.texto_botao else 'Comprar Agora' }}</span>
    </button>
  </div>
  <div class="hero-image">
    {% if hero and hero.imagem_url %}
    <img src="{{ hero.imagem_url }}" alt="{{ hero.titulo if hero and hero.titulo else 'A felicidade de usar LhamaBanana!' }}">
    {% else %}
    <img src="{{ url_for('static', filename='img/carrossel/img2.jpeg') }}" alt="A felicidade de usar LhamaBanana!">
    {% endif %}
  </div>
</section>

<section class="destaques">
    <div class="container">
        <div class="destaques-filtros">
            {% if carrosseis %}
                {% for carrossel in carrosseis %}
                    {% if carrossel.ativo %}
                    <button class="filtro-btn {% if loop.first %}ativo{% endif %}" data-target="#carrossel-{{ carrossel.slug }}">
                        {{ carrossel.nome }}
                    </button>
                    {% endif %}
                {% endfor %}
            {% else %}
                <!-- Fallback para carross√©is padr√£o -->
                <button class="filtro-btn ativo" data-target="#carrossel-destaques">Destaques</button>
                <button class="filtro-btn" data-target="#carrossel-vendidos">Mais Vendidos</button>
                <button class="filtro-btn" data-target="#carrossel-inverno">Cole√ß√£o Inverno</button>
                <button class="filtro-btn" data-target="#carrossel-verao">Cole√ß√£o Ver√£o</button>
                <button class="filtro-btn" data-target="#carrossel-familia">Conjuntos Fam√≠lia</button>
            {% endif %}
        </div>

        <div class="carrossel-container">
            {% if carrosseis %}
                {% for carrossel in carrosseis %}
                    {% if carrossel.ativo and carrossel.itens %}
                    <div id="carrossel-{{ carrossel.slug }}" class="swiper carrossel-produtos {% if loop.first %}ativo{% endif %}" style="{% if not loop.first %}display: none;{% endif %}">
                        <div class="swiper-wrapper">
                            {% for item in carrossel.itens %}
                                {% if item.ativo %}
                                <div class="swiper-slide">
                                    <div class="carrossel-item-card">
                                        <a href="{{ item.link if item.link else url_for('produtos.produtos_page') }}" class="carrossel-item-link">
                                            <div class="carrossel-item-image">
                                                <img src="{{ item.imagem }}" alt="{{ item.titulo }}">
                                            </div>
                                            <div class="carrossel-item-content">
                                                <h3 class="carrossel-item-titulo">{{ item.titulo }}</h3>
                                                {% if item.subtitulo %}
                                                <p class="carrossel-item-subtitulo">{{ item.subtitulo }}</p>
                                                {% endif %}
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <!-- Fallback: Carrossel padr√£o se n√£o houver carross√©is configurados -->
                <div id="carrossel-destaques" class="swiper carrossel-produtos ativo">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="carrossel-item-card">
                                <a href="{{ url_for('produtos.produtos_page') }}" class="carrossel-item-link">
                                    <div class="carrossel-item-image">
                                        <img src="https://via.placeholder.com/300x400" alt="Produto">
                                    </div>
                                    <div class="carrossel-item-content">
                                        <h3 class="carrossel-item-titulo">Produto Destaque</h3>
                                        <p class="carrossel-item-subtitulo">Conforto e qualidade para sua fam√≠lia</p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            {% endif %}
        </div>

        <div class="cta-loja">
            <a href="#" class="botao botao-destaque">Ver todos os produtos</a>
        </div>
    </div>
</section>

<!-- Se√ß√£o Sobre Nossa Loja -->
<section class="sobre-loja">
    <div class="container">
        <!-- Frases de Efeito -->
        <div class="frases-efeito">
            <h2 class="titulo-secao">Qualidade que voc√™ pode confiar</h2>
            <p class="destaque">Na LhamaBanana‚Ñ¢, cada pe√ßa √© feita com materiais premium e muito carinho para garantir o m√°ximo de conforto e durabilidade para sua fam√≠lia.</p>
        </div>
        
        <!-- Destaques de Qualidade -->
        <div class="destaques-container">
            <div class="destaques-qualidade">
                <div class="item-qualidade">
                    <div class="icone-qualidade">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>Feito com Amor</h3>
                    <p>Cada pe√ßa √© cuidadosamente confeccionada pensando no bem-estar da sua fam√≠lia.</p>
                </div>
                
                <div class="item-qualidade">
                    <div class="icone-qualidade">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h3>Materiais Sustent√°veis</h3>
                    <p>Utilizamos tecidos de alta qualidade e pr√°ticas sustent√°veis em nossa produ√ß√£o.</p>
                </div>
                
                <div class="item-qualidade">
                    <div class="icone-qualidade">
                        <i class="fas fa-medal"></i>
                    </div>
                    <h3>Garantia de Qualidade</h3>
                    <p>Nossos produtos passam por rigorosos controles de qualidade antes de chegarem at√© voc√™.</p>
                </div>
            </div>
            
            <div class="estatisticas">
                <div class="estatistica-item">
                    <span class="numero">+{{ estatisticas.clientes if estatisticas else 5000 }}</span>
                    <span class="rotulo">Clientes Satisfeitos</span>
                </div>
                <div class="estatistica-item">
                    <span class="numero">+{{ estatisticas.pecas if estatisticas else 10000 }}</span>
                    <span class="rotulo">Pe√ßas Vendidas</span>
                </div>
                <div class="estatistica-item">
                    <span class="numero">+{{ estatisticas.anos if estatisticas else 5 }}</span>
                    <span class="rotulo">Anos de Mercado</span>
                </div>
            </div>
        </div>
        
        <!-- Depoimentos -->
        <div class="depoimentos-container">
            <h3 class="subtitulo-secao">O que nossos clientes dizem</h3>
            <div class="depoimentos-carousel-wrapper">
                <button class="carousel-btn carousel-btn-prev" aria-label="Depoimentos anteriores">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
                <div class="depoimentos-carousel">
                    <div class="depoimentos-track" data-total="{{ depoimentos|length if depoimentos else 1 }}">
                        {% if depoimentos %}
                            {% for depoimento in depoimentos %}
                            <div class="depoimento-item">
                                <div class="depoimento">
                                    <div class="aspas">"</div>
                                    <p class="texto-depoimento">{{ depoimento.texto }}</p>
                                    <div class="autor-depoimento">
                                        <div class="info-cliente">
                                            <span class="nome">{{ depoimento.nome }}</span>
                                            {% if depoimento.subtitulo %}
                                            <span class="cargo">{{ depoimento.subtitulo }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <!-- Fallback para depoimento padr√£o -->
                            <div class="depoimento-item">
                                <div class="depoimento">
                                    <div class="aspas">"</div>
                                    <p class="texto-depoimento">A LhamaBanana‚Ñ¢ transformou as noites da minha fam√≠lia. A qualidade dos produtos √© incr√≠vel e o atendimento √© excepcional!</p>
                                    <div class="autor-depoimento">
                                        <div class="info-cliente">
                                            <span class="nome">Ana Silva</span>
                                            <span class="cargo">M√£e e Cliente desde 2022</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <button class="carousel-btn carousel-btn-next" aria-label="Pr√≥ximos depoimentos">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Chamada para Sobre N√≥s -->
        <div class="cta-sobre">
            <h3>Quer saber mais sobre nossa hist√≥ria e valores?</h3>
            <p>Conhe√ßa nossa trajet√≥ria e o que nos torna especiais</p>
            <a href="/sobre" class="botao botao-destaque">Conhe√ßa Nossa Hist√≥ria</a>
        </div>
    </div>
</section>

<!-- Se√ß√£o Contato e Newsletter -->
<section class="contato-newsletter">
    <div class="container">
        <div class="contato-conteudo">
            <!-- Contato -->
            <div class="contato-info">
                <h2 class="titulo-secao">Fale Conosco</h2>
                <p class="descricao">Estamos sempre √† disposi√ß√£o para tirar suas d√∫vidas e receber seu feedback.</p>
                
                <div class="redes-sociais">
                    {% if empresa and empresa.redes_sociais and empresa.redes_sociais.whatsapp %}
                    <a href="{{ empresa.redes_sociais.whatsapp }}" target="_blank" class="botao-rede-social whatsapp">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </a>
                    {% endif %}
                    {% if empresa and empresa.redes_sociais and empresa.redes_sociais.instagram %}
                    <a href="{{ empresa.redes_sociais.instagram }}" target="_blank" class="botao-rede-social instagram">
                        <i class="fab fa-instagram"></i>
                        <span>Instagram</span>
                    </a>
                    {% endif %}
                </div>
                
                <div class="info-contato">
                    {% if empresa and empresa.email %}
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h4>E-mail</h4>
                            <p>{{ empresa.email }}</p>
                        </div>
                    </div>
                    {% endif %}
                    {% if empresa and empresa.telefone %}
                    <div class="info-item">
                        <i class="fas fa-phone-alt"></i>
                        <div>
                            <h4>Telefone</h4>
                            <p>{{ empresa.telefone }}</p>
                        </div>
                    </div>
                    {% endif %}
                    {% if empresa and empresa.horario_atendimento %}
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h4>Hor√°rio de Atendimento</h4>
                            <p>{{ empresa.horario_atendimento|replace('\n', '<br>')|safe }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Newsletter -->
            <div class="newsletter">
                <div class="newsletter-conteudo">
                    <h3>Receba Nossas Ofertas</h3>
                    <p>Cadastre-se e receba promo√ß√µes exclusivas diretamente no seu e-mail.</p>
                    
                    <form class="form-newsletter" id="formNewsletter">
                        <div class="campo-form">
                            <i class="fas fa-user"></i>
                            <input type="text" placeholder="Seu nome" required>
                        </div>
                        <div class="campo-form">
                            <i class="fas fa-envelope"></i>
                            <input type="email" placeholder="Seu melhor e-mail" required>
                        </div>
                        <button type="submit" class="botao botao-enviar">
                            <span>Quero receber ofertas</span>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                    
                    <div class="seguranca">
                        <i class="fas fa-lock"></i>
                        <span>Seus dados est√£o seguros conosco. N√£o enviamos spam.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Swiper JS -->
    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Armazena todas as inst√¢ncias do Swiper
            const swipers = {};
            
            // Seleciona todos os carross√©is
            const carrosseis = document.querySelectorAll('.carrossel-produtos');
            const filtroBtns = document.querySelectorAll('.filtro-btn');
            
            // Fun√ß√£o para inicializar um carrossel
            function initCarrossel(carrosselId) {
                if (swipers[carrosselId]) return; // J√° foi inicializado
                
                const carrossel = document.getElementById(carrosselId);
                if (!carrossel) return;
                
                swipers[carrosselId] = new Swiper(`#${carrosselId}`, {
                    loop: true,
                    slidesPerView: 1,
                    spaceBetween: 20,
                    navigation: {
                        nextEl: `#${carrosselId} .swiper-button-next`,
                        prevEl: `#${carrosselId} .swiper-button-prev`,
                    },
                    breakpoints: {
                        640: { slidesPerView: 2 },
                        768: { slidesPerView: 3 },
                        1024: { slidesPerView: 4 },
                    },
                    on: {
                        init: function() {
                            this.update();
                        }
                    }
                });
                
                return swipers[carrosselId];
            }
            
            // Inicializa o primeiro carrossel vis√≠vel (ativo)
            const primeiroCarrossel = document.querySelector('.carrossel-produtos.ativo');
            if (primeiroCarrossel) {
                const primeiroId = primeiroCarrossel.id;
                initCarrossel(primeiroId);
            } else {
                // Fallback: tenta inicializar carrossel-destaques se existir
                const fallbackCarrossel = document.getElementById('carrossel-destaques');
                if (fallbackCarrossel) {
                    initCarrossel('carrossel-destaques');
                }
            }
            
            // Esconde os outros carross√©is (que n√£o t√™m classe ativo)
            document.querySelectorAll('.carrossel-produtos:not(.ativo)').forEach(c => {
                c.style.display = 'none';
            });
            
            // L√≥gica para os bot√µes de filtro
            filtroBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove a classe 'ativo' de todos os bot√µes
                    filtroBtns.forEach(b => b.classList.remove('ativo'));
                    // Adiciona a classe 'ativo' ao bot√£o clicado
                    this.classList.add('ativo');
                    
                    // Esconde todos os carross√©is
                    carrosseis.forEach(c => {
                        c.style.display = 'none';
                    });
                    
                    // Mostra apenas o carrossel alvo
                    const targetId = this.getAttribute('data-target').substring(1);
                    const targetCarrossel = document.getElementById(targetId);
                    if (targetCarrossel) {
                        targetCarrossel.style.display = 'block';
                        // Inicializa o carrossel se ainda n√£o foi inicializado
                        initCarrossel(targetId);
                        // Atualiza o Swiper quando o carrossel √© mostrado
                        if (swipers[targetId]) {
                            setTimeout(() => {
                                swipers[targetId].update();
                                swipers[targetId].updateSlides();
                                swipers[targetId].updateSize();
                                swipers[targetId].updateSlidesClasses();
                            }, 10);
                        }
                    }
                });
            });
            
            // Atualiza os Swipers quando a janela √© redimensionada
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    Object.values(swipers).forEach(swiper => {
                        if (swiper && typeof swiper.update === 'function') {
                            swiper.update();
                            swiper.updateSlides();
                            swiper.updateSize();
                            swiper.updateSlidesClasses();
                        }
                    });
                }, 250);
            });
        });
    </script>

{% endblock %}

{% block scripts %}
<script>
    // Carrossel de Depoimentos
    document.addEventListener('DOMContentLoaded', function() {
        const track = document.querySelector('.depoimentos-track');
        const prevBtn = document.querySelector('.carousel-btn-prev');
        const nextBtn = document.querySelector('.carousel-btn-next');
        const carousel = document.querySelector('.depoimentos-carousel');
        
        if (!track || !prevBtn || !nextBtn || !carousel) return;
        
        const totalItems = track.children.length;
        let currentIndex = 0;
        
        function getItemsPerView() {
            const width = window.innerWidth;
            if (width <= 768) return 1;
            if (width <= 992) return 2;
            return 3;
        }
        
        function updateCarousel() {
            const itemsPerView = getItemsPerView();
            const maxIndex = Math.max(0, totalItems - itemsPerView);
            
            // Calcular deslocamento baseado na largura do primeiro item
            if (track.children.length > 0) {
                const firstItem = track.children[0];
                const itemWidth = firstItem.offsetWidth;
                const gap = 30;
                const translateX = -(currentIndex * (itemWidth + gap));
                
                track.style.transform = `translateX(${translateX}px)`;
            }
            
            // Atualizar estado dos bot√µes
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex >= maxIndex;
        }
        
        function goToNext() {
            const itemsPerView = getItemsPerView();
            const maxIndex = Math.max(0, totalItems - itemsPerView);
            if (currentIndex < maxIndex) {
                currentIndex++;
                updateCarousel();
            }
        }
        
        function goToPrev() {
            if (currentIndex > 0) {
                currentIndex--;
                updateCarousel();
            }
        }
        
        nextBtn.addEventListener('click', goToNext);
        prevBtn.addEventListener('click', goToPrev);
        
        // Ajustar no resize
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                const itemsPerView = getItemsPerView();
                const maxIndex = Math.max(0, totalItems - itemsPerView);
                if (currentIndex > maxIndex) {
                    currentIndex = maxIndex;
                }
                updateCarousel();
            }, 250);
        });
        
        // Inicializar
        updateCarousel();
    });
</script>
{% endblock %}
