{% extends "base.html" %}

{% block title %}Status do Pedido - LhamaBanana{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/buttons.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/order_status.css') }}">
{% endblock %}

{% block content %}
<div class="order-status-container">
    <div class="status-header animate-fadeInUp">
        <div class="header-icon">üì¶</div>
        <h1>Status do Pedido</h1>
        <p>Acompanhe o status do seu pedido em tempo real</p>
    </div>

    <div class="status-content">
        <!-- Card Principal com Status -->
        <div class="status-card card animate-fadeInUp">
            <!-- Indicador de Status Atual -->
            <div class="current-status-section">
                <div class="status-indicator status-{{ status.lower().replace(' ', '-') if status else 'pendente' }}" id="currentStatusIndicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span class="status-text" id="currentStatusText">
                        {% if status == 'CRIADO' %}Pedido Criado
                        {% elif status == 'PENDENTE' %}Aguardando Pagamento
                        {% elif status == 'PAGO' %}Pagamento Confirmado
                        {% elif status == 'APROVADO' %}Pedido Aprovado
                        {% elif status == 'NA TRANSPORTADORA' %}Na Transportadora
                        {% elif status == 'ENTREGUE' %}Entregue
                        {% elif status == 'CANCELADO' %}Pedido Cancelado
                        {% elif status == 'EXPIRADO' %}Pedido Expirado
                        {% else %}Carregando...{% endif %}
                    </span>
                </div>
            </div>

            <!-- Timeline de Status -->
            <div class="status-timeline">
                <div class="timeline-item" data-status="CRIADO">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Pedido Criado</h3>
                        <p>Seu pedido foi criado com sucesso</p>
                        <span class="timeline-date" id="dateCRIADO">--</span>
                    </div>
                </div>

                <div class="timeline-item" data-status="PENDENTE">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Aguardando Pagamento</h3>
                        <p>Estamos aguardando a confirma√ß√£o do pagamento</p>
                        <span class="timeline-date" id="datePENDENTE">--</span>
                    </div>
                </div>

                <div class="timeline-item" data-status="PAGO">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Pagamento Confirmado</h3>
                        <p>Pagamento recebido e confirmado</p>
                        <span class="timeline-date" id="datePAGO">--</span>
                    </div>
                </div>

                <div class="timeline-item" data-status="APROVADO">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Pedido Aprovado</h3>
                        <p>Seu pedido foi aprovado e est√° sendo preparado</p>
                        <span class="timeline-date" id="dateAPROVADO">--</span>
                    </div>
                </div>

                <div class="timeline-item" data-status="NA TRANSPORTADORA">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Na Transportadora</h3>
                        <p>Seu pedido est√° a caminho</p>
                        <span class="timeline-date" id="dateNA TRANSPORTADORA">--</span>
                    </div>
                </div>

                <div class="timeline-item" data-status="ENTREGUE">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Entregue</h3>
                        <p>Seu pedido foi entregue com sucesso!</p>
                        <span class="timeline-date" id="dateENTREGUE">--</span>
                    </div>
                </div>

                <!-- Status de Cancelamento/Expira√ß√£o -->
                <div class="timeline-item timeline-item-error" data-status="CANCELADO" style="display: none;">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Pedido Cancelado</h3>
                        <p>Este pedido foi cancelado</p>
                        <span class="timeline-date" id="dateCANCELADO">--</span>
                    </div>
                </div>

                <div class="timeline-item timeline-item-error" data-status="EXPIRADO" style="display: none;">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>Pedido Expirado</h3>
                        <p>O prazo de pagamento expirou</p>
                        <span class="timeline-date" id="dateEXPIRADO">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card com Informa√ß√µes do Pedido -->
        <div class="order-info-card card animate-fadeInUp">
            <div class="info-header">
                <h2>üìã Informa√ß√µes do Pedido</h2>
            </div>
            
            <div class="info-content">
                <div class="info-row">
                    <span class="info-label">C√≥digo do Pedido:</span>
                    <span class="info-value" id="orderCode">{{ order_code if order_code else '--' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Valor Total:</span>
                    <span class="info-value" id="orderValue">{{ order_value if order_value else 'R$ 0,00' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Data do Pedido:</span>
                    <span class="info-value" id="orderDate">{{ order_date if order_date else '--' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">√öltima Atualiza√ß√£o:</span>
                    <span class="info-value" id="lastUpdate">{{ last_update if last_update else '--' }}</span>
                </div>
            </div>
        </div>

        <!-- Card de Rastreio de Envio -->
        <div class="tracking-card card animate-fadeInUp" id="trackingCard" style="display: none;">
            <div class="info-header">
                <h2>üöö Rastreio de Envio</h2>
            </div>
            
            <div class="tracking-content" id="trackingContent">
                <div class="tracking-info" id="trackingInfo">
                    <div class="info-row" id="trackingCodeRow" style="display: none;">
                        <span class="info-label">C√≥digo de Rastreamento:</span>
                        <span class="info-value tracking-code" id="trackingCode">--</span>
                    </div>
                    <div class="info-row" id="transportadoraRow" style="display: none;">
                        <span class="info-label">Transportadora:</span>
                        <span class="info-value" id="transportadora">--</span>
                    </div>
                </div>
                
                <div class="tracking-action" id="trackingAction" style="display: none;">
                    <a href="#" target="_blank" rel="noopener noreferrer" class="btn btn-primary" id="trackingLink">
                        <i class="fas fa-external-link-alt"></i>
                        <span>Rastrear Pedido</span>
                    </a>
                </div>
                
                <div class="tracking-status" id="trackingStatus" style="display: none;">
                    <p class="tracking-status-text">
                        <i class="fas fa-info-circle"></i>
                        <span id="trackingStatusText">Aguardando envio...</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Card de A√ß√µes -->
        <div class="actions-card card animate-fadeInUp">
            <div class="actions-content">
                <button type="button" id="refreshStatus" class="btn-secondary">
                    <span>üîÑ</span>
                    <span>Atualizar Status</span>
                </button>
                <a href="{{ url_for('main.home') }}" class="btn-primary">
                    <span>üè†</span>
                    <span>Voltar ao In√≠cio</span>
                </a>
            </div>
        </div>

        <!-- Mensagem de Pedido Entregue -->
        <div class="delivered-message card animate-fadeInUp" id="deliveredMessage" style="display: none;">
            <div class="message-content">
                <div class="message-icon">‚úÖ</div>
                <h2>Pedido Entregue!</h2>
                <p>Obrigado pela sua compra! Esperamos que tenha gostado dos nossos produtos.</p>
                <p class="message-note">Este pedido foi finalizado e n√£o est√° mais dispon√≠vel para consulta.</p>
            </div>
        </div>

        <!-- Mensagem de Erro/Acesso Negado -->
        <div class="error-message card animate-fadeInUp" id="errorMessage" style="display: none;">
            <div class="message-content">
                <div class="message-icon">‚ö†Ô∏è</div>
                <h2>Pedido n√£o encontrado</h2>
                <p>O pedido solicitado n√£o foi encontrado ou n√£o est√° mais dispon√≠vel.</p>
                <a href="{{ url_for('main.home') }}" class="btn-primary">
                    <span>üè†</span>
                    <span>Voltar ao In√≠cio</span>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="statusLoading" class="loading-overlay" style="display: none;">
    <div class="loading-content">
        <div class="loading-spinner"><i class="fas fa-spinner"></i></div>
        <h3>Carregando status...</h3>
        <p>Por favor, aguarde</p>
    </div>
</div>
{% endblock %}

{% block page_js %}
<script src="{{ url_for('main.static', filename='js/order_status.js') }}"></script>
{% endblock %}

